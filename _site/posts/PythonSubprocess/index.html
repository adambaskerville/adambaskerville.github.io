<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="T&gt;T: Call C++ From Python Without Wrapping" /><meta property="og:locale" content="en" /><meta name="description" content="Using subprocess to quickly and easily call a C++ program, whilst keeping input pipe open." /><meta property="og:description" content="Using subprocess to quickly and easily call a C++ program, whilst keeping input pipe open." /><link rel="canonical" href="https://adambaskerville.github.io/posts/PythonSubprocess/" /><meta property="og:url" content="https://adambaskerville.github.io/posts/PythonSubprocess/" /><meta property="og:site_name" content="Dr Adam Luke Baskerville" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-08-29T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="T&gt;T: Call C++ From Python Without Wrapping" /><meta name="twitter:site" content="@SciBaskerville" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2019-08-29T00:00:00+01:00","datePublished":"2019-08-29T00:00:00+01:00","description":"Using subprocess to quickly and easily call a C++ program, whilst keeping input pipe open.","headline":"T&gt;T: Call C++ From Python Without Wrapping","mainEntityOfPage":{"@type":"WebPage","@id":"https://adambaskerville.github.io/posts/PythonSubprocess/"},"url":"https://adambaskerville.github.io/posts/PythonSubprocess/"}</script><title>T>T: Call C++ From Python Without Wrapping | Dr Adam Luke Baskerville</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Dr Adam Luke Baskerville"><meta name="application-name" content="Dr Adam Luke Baskerville"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="/assets/js/data/mathjax.js"></script> <script async src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml.js"></script> <script> document.addEventListener('DOMContentLoaded', () => { const pv = document.getElementById('pageviews'); if (pv !== null) { const uri = location.pathname.replace(/\/$/, ''); const url = `https://albaskerville.goatcounter.com/counter/${encodeURIComponent(uri)}.json`; fetch(url) .then((response) => response.json()) .then((data) => { const count = data.count.replace(/\D/g, ''); pv.innerText = new Intl.NumberFormat().format(count); }) .catch((error) => { pv.innerText = '1'; }); } }); </script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script async src="https://gc.zgo.at/count.js" data-goatcounter="https://albaskerville.goatcounter.com/count" ></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/Baskerville_Bletchley_Crop.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Dr Adam Luke Baskerville</a><p class="site-subtitle fst-italic mb-0">Quantum Physicist <a href=https://www.kvantify.com/>@Kvantify</a></p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>T>T</span> </a><li class="nav-item"> <a href="/presentations/" class="nav-link"> <i class="fa-fw fas fa-newspaper"></i> <span>PRESENTATIONS</span> </a><li class="nav-item"> <a href="/progchem/" class="nav-link"> <i class="fa-fw fas fa-newspaper"></i> <span>PROGRAMMING COURSE</span> </a><li class="nav-item"> <a href="/publications/" class="nav-link"> <i class="fa-fw fas fa-newspaper"></i> <span>PUBLICATIONS</span> </a><li class="nav-item"> <a href="/painting/" class="nav-link"> <i class="fa-fw fas fa-newspaper"></i> <span>PAINTING</span> </a><li class="nav-item"> <a href="/astrophotography/" class="nav-link"> <i class="fa-fw fas fa-newspaper"></i> <span>ASTROPHOTOGRAPHY</span> </a><li class="nav-item"> <a href="/astro/" class="nav-link"> <i class="fa-fw fas fa-newspaper"></i> <span>ASTROPITOGRAPHY</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/adambaskerville" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/SciBaskerville" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['adamlukebaskerville','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>T>T: Call C++ From Python Without Wrapping</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>T>T: Call C++ From Python Without Wrapping</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1567033200" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 29, 2019 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/SciBaskerville">Adam Baskerville</a> </em> </span><div> <span> <em id="pageviews"> <i class="fas fa-spinner fa-spin small"></i> </em> views </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1619 words" > <em>8 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">T>T: Call C++ From Python Without Wrapping</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">T>T: Call C++ From Python Without Wrapping</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><h2 id="the-problem"><span class="me-2">The Problem:</span><a href="#the-problem" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We want to programmatically find the minimum value of the following simple function</p><p>\[ f(x,y) = x^2 + y^2 + 3 \tag{1} \] We already know the answer to this, \(\text{min}(f(x,y)) = 3 \) when \(x=0,y=0\) but the catch and purpose of this post is that the function declaration is written in C++ whilst we want to optimise it from Python. Why even bother with this? Programming the minimisation of such a simple function is trivial in both languages but there are several reasons why this process might be very useful for more complex problems, including:</p><ol><li><p>Limitations of the Python language to solve a problem, requiring lower level languages.</p><li><p>You want to use Python as a front-end. Python is excellent at ‘gluing’ other languages together, meaning you optimise the computationally demanding code in lower level languages such as C++ or Fortran with everything else done in Python saving a lot of programming time.</p><li><p>The quantity being minimised takes too long to calculate in Python and is much faster in C++.</p></ol><p>Conventionally, calling C++ from Python is achieved by wrapping the C++ program so as to directly call it from Python. There are multiple ways to achieve this including <a href="https://www.boost.org/doc/libs/1_66_0/libs/python/doc/html/index.html">Boost Python</a>, <a href="http://www.swig.org/">Swig</a> and <a href="https://cython.org/">Cython</a> all of which work very well; but can require considerable time to accomplish depending on how complicated the program you are trying to wrap is. Time is precious in scientific research so rather than spend time wrapping a complicated C++ program I will sometimes use an alternative, <strong>subprocessing</strong>.</p><h2 id="subprocessing"><span class="me-2">Subprocessing</span><a href="#subprocessing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The <a href="https://docs.python.org/2/library/subprocess.html">Subprocess</a> Python module is a way to spawn new processes and connect to their input/output pipes. This means that we can directly call the C++ executable from Python, pass it input and then grab the return code/returned result to Python. The benefit of this approach is that it is incredibly easy to implement.</p><p>Let’s think about the individual tasks C++ and Python need to accomplish to make them “talk” to one another in order to minimise the function in equation (1).</p><p><strong>C++:</strong></p><ol><li><p>Calculate the value of the function for specified values of \(x\) and \(y\).</p><li><p>Output this value so Python is able to grab it.</p><li><p>Wait for Python to provide new values of \(x\) and \(y\).</p><li><p>Repeat until the Python program terminates the executable.</p></ol><p><strong>Python:</strong></p><ol><li><p>Control the minimisation process, easily done using <code class="language-plaintext highlighter-rouge">scipy</code>.</p><li><p>Initiate the subprocess to call the C++ executable.</p><li><p>Pass the values of \(x\) and \(y\) for each optimisation step to the C++ subprocess.</p><li><p>Repeat until convergence tolerance is achieved.</p><li><p>Kill the subprocess so it does not hang indefinitely.</p></ol><h2 id="c-program"><span class="me-2">C++ Program</span><a href="#c-program" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The C++ program, <code class="language-plaintext highlighter-rouge">Subprocess.cpp</code> looks like this</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;math.h&gt;</span><span class="cp">
</span>
<span class="c1">// Define the function to be minimised, x**2 + y**2 + 3</span>
<span class="kt">double</span> <span class="nf">FuncValue</span> <span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span>
<span class="p">{</span>    
    <span class="k">return</span> <span class="n">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>	
    <span class="c1">// Declare the data types of the input values x and y</span>
    <span class="kt">double</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">printf</span><span class="p">(</span><span class="s">"This C++ program will be called from Python continuously</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">do</span> 
    <span class="p">{</span>   
        <span class="c1">// This reads in the command line input and assigns to x and y</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">x</span><span class="p">;</span> 
        <span class="n">std</span><span class="o">::</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">y</span><span class="p">;</span> 
        
        <span class="c1">// Print function value to the terminal</span>
        <span class="n">std</span><span class="o">::</span><span class="n">printf</span><span class="p">(</span><span class="s">"%.16f </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">FuncValue</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">));</span>
        
        <span class="c1">// Clear cin</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// Keep do loop running indefinitely</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Note, the newline character <code class="language-plaintext highlighter-rouge">\n</code> is <strong>vital</strong> in the <code class="language-plaintext highlighter-rouge">printf</code> statements. This sends the signal to Python that something has been returned. if they are not included the program will hang and nothing will be returned. For this example the Python program will terminate the executable by using its session id, which is not very elegant but works very well. A more elegant option is to specify a custom flag for the <code class="language-plaintext highlighter-rouge">while</code> condition. For example <code class="language-plaintext highlighter-rouge">while (std::cin.get() != 'KILL')</code>. This then means that we can pass the word <code class="language-plaintext highlighter-rouge">KILL</code> from Python and the executable terminates itself.</p><p>An important feature of this program is the <code class="language-plaintext highlighter-rouge">do while</code> loop. Inside this loop <code class="language-plaintext highlighter-rouge">cin</code> is declared which means the program will continually loop waiting for user input, which will be given to it by Python. We have to make it wait otherwise we would need to terminate and restart the executable for every optimisation step. This is no issue for such a trivial example, but adds substantial computational overhead for more complex examples.</p><p>To compile this program type the following into the terminal</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>g++ Subprocess.cpp <span class="nt">-o</span> Subprocess
</pre></table></code></div></div><h2 id="python-program"><span class="me-2">Python Program</span><a href="#python-program" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The Python program, <code class="language-plaintext highlighter-rouge">Subprocess.py</code> looks like this</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">signal</span>
<span class="kn">from</span> <span class="n">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span><span class="p">,</span> <span class="n">STDOUT</span>
<span class="kn">import</span> <span class="n">scipy</span> <span class="k">as</span> <span class="n">sp</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
      
<span class="k">def</span> <span class="nf">CallCpp</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Pipe the x and y values to the C++ executable
</span>    <span class="n">process</span><span class="p">.</span><span class="n">stdin</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">'</span><span class="s">{} {}</span><span class="se">\n</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    <span class="n">process</span><span class="p">.</span><span class="n">stdin</span><span class="p">.</span><span class="nf">flush</span><span class="p">()</span>
    
    <span class="n">FuncValue</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="n">process</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="nf">readline</span><span class="p">())</span>

    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">x={:.6E} y={:.6E} f(x,y)={:.16f}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">FuncValue</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">FuncValue</span>

<span class="c1"># Initiate the subprocess by calling the Subprocess executable we just compiled
# 'universal_newlines' is a handy option as it means we don't have to supply the input as a byte string or decode the output string as utf-8 as the file objects stdout and stderr are opened as text files in universal newlines mode
# preexec_fn=os.setsid assigns a session id to the subprocess which we use later on to terminate it
</span><span class="n">process</span> <span class="o">=</span> <span class="nc">Popen</span><span class="p">(</span><span class="sh">'</span><span class="s">./Subprocess</span><span class="sh">'</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">universal_newlines</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">preexec_fn</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">setsid</span><span class="p">)</span>

<span class="c1"># Tell Python that the first line output by C++ is: "This C++ program will be called from Python continuously" otherwise it will prevent the values of x and y being piped
</span><span class="nf">print</span><span class="p">(</span><span class="n">process</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="nf">readline</span><span class="p">())</span> 

<span class="c1"># provide the starting values for x and y
</span><span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># Minimise the function CallCpp using the Nelder-Mead algorithm
</span><span class="n">Func_min</span> <span class="o">=</span> <span class="nf">minimize</span><span class="p">(</span><span class="n">CallCpp</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="sh">'</span><span class="s">nelder-mead</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># Kill the subprocess
</span><span class="n">os</span><span class="p">.</span><span class="nf">killpg</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="nf">getpgid</span><span class="p">(</span><span class="n">process</span><span class="p">.</span><span class="n">pid</span><span class="p">),</span> <span class="n">signal</span><span class="p">.</span><span class="n">SIGTERM</span><span class="p">)</span>
</pre></table></code></div></div><p>The newline character in <code class="language-plaintext highlighter-rouge">process.stdin.write('{} {}\n'.format(x, y))</code> is also <strong>vital</strong>. If this is not included then we have not actually entered the \(x\) and \(y\) values into the executable. Think of the <code class="language-plaintext highlighter-rouge">\n</code> acting as the enter key.</p><h2 id="the-result"><span class="me-2">The Result</span><a href="#the-result" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To run the Python program type the following</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python3 Subprocess.py
</pre></table></code></div></div><p>This gives the following output</p><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
</pre><td class="rouge-code"><pre>This C++ program will be called from Python continuously

x=2.000000E+00 y=2.000000E+00 f(x,y)=11.0000000000000000

x=2.100000E+00 y=2.000000E+00 f(x,y)=11.4100000000000001

x=2.000000E+00 y=2.100000E+00 f(x,y)=11.4100000000000001

x=2.100000E+00 y=1.900000E+00 f(x,y)=11.0199999999999978

x=2.000000E+00 y=1.900000E+00 f(x,y)=10.6099999999999977

x=1.950000E+00 y=1.850000E+00 f(x,y)=10.2249999999999961

x=1.850000E+00 y=1.950000E+00 f(x,y)=10.2249999999999979

x=1.800000E+00 y=1.800000E+00 f(x,y)=9.4799999999999933

x=1.700000E+00 y=1.700000E+00 f(x,y)=8.7799999999999923

x=1.800000E+00 y=1.600000E+00 f(x,y)=8.7999999999999901

x=1.550000E+00 y=1.450000E+00 f(x,y)=7.5049999999999875

x=1.350000E+00 y=1.250000E+00 f(x,y)=6.3849999999999847

x=1.250000E+00 y=1.350000E+00 f(x,y)=6.3849999999999865

x=9.000000E-01 y=9.000000E-01 f(x,y)=4.6199999999999850

x=5.000000E-01 y=5.000000E-01 f(x,y)=3.4999999999999885

x=6.000000E-01 y=4.000000E-01 f(x,y)=3.5199999999999871

x=-2.500000E-01 y=-3.500000E-01 f(x,y)=3.1850000000000098

x=-1.050000E+00 y=-1.150000E+00 f(x,y)=5.4250000000000522

x=-3.500000E-01 y=-2.500000E-01 f(x,y)=3.1850000000000112

x=-1.100000E+00 y=-1.100000E+00 f(x,y)=5.4200000000000523

x=1.000000E-01 y=1.000000E-01 f(x,y)=3.0199999999999969

x=2.000000E-01 y=-4.551914E-15 f(x,y)=3.0399999999999956

x=5.500000E-01 y=4.500000E-01 f(x,y)=3.5049999999999879

x=-5.000000E-02 y=-1.500000E-01 f(x,y)=3.0250000000000026

x=-1.500000E-01 y=-5.000000E-02 f(x,y)=3.0250000000000039

x=-6.250000E-02 y=-3.750000E-02 f(x,y)=3.0053125000000018

x=8.750000E-02 y=2.125000E-01 f(x,y)=3.0528124999999964

x=-1.562500E-02 y=-5.937500E-02 f(x,y)=3.0037695312500010

x=-1.781250E-01 y=-1.968750E-01 f(x,y)=3.0704882812500061

x=3.046875E-02 y=2.578125E-02 f(x,y)=3.0015930175781240

x=7.734375E-02 y=3.906250E-03 f(x,y)=3.0059973144531233

x=-2.753906E-02 y=-2.714844E-02 f(x,y)=3.0014954376220713

x=1.855469E-02 y=5.800781E-02 f(x,y)=3.0037091827392568

x=1.000977E-02 y=2.866211E-02 f(x,y)=3.0009217119216913

x=-4.799805E-02 y=-2.426758E-02 f(x,y)=3.0028927278518691

x=1.085205E-02 y=1.326904E-02 f(x,y)=3.0002938345074650

x=4.840088E-02 y=6.907959E-02 f(x,y)=3.0071146348118765

x=-8.554077E-03 y=-3.091431E-03 f(x,y)=3.0000827291794123

x=-7.711792E-03 y=-1.848450E-02 f(x,y)=3.0004011483676734

x=-3.281403E-03 y=-6.697845E-03 f(x,y)=3.0000556287367366

x=-2.268753E-02 y=-2.305832E-02 f(x,y)=3.0010464101203258

x=2.467155E-03 y=4.187202E-03 f(x,y)=3.0000236195204342

x=7.739830E-03 y=5.807877E-04 f(x,y)=3.0000602422829976

x=3.666353E-03 y=-3.372669E-04 f(x,y)=3.0000135558949523

x=9.414911E-03 y=1.054778E-02 f(x,y)=3.0001998962380498

x=-1.073241E-04 y=-2.386439E-03 f(x,y)=3.0000057066088361

x=1.091874E-03 y=-6.910908E-03 f(x,y)=3.0000489528405141

x=2.123335E-03 y=1.412675E-03 f(x,y)=3.0000065042015858

x=-1.650342E-03 y=-6.364971E-04 f(x,y)=3.0000031287584656

x=-4.308690E-03 y=-7.861122E-04 f(x,y)=3.0000191827831104

x=-3.881001E-03 y=-4.435611E-03 f(x,y)=3.0000347368153428

x=6.222509E-04 y=-4.939660E-05 f(x,y)=3.0000003896361882

x=-9.207673E-04 y=1.700545E-03 f(x,y)=3.0000037396661341

x=-7.174065E-04 y=6.787991E-04 f(x,y)=3.0000009754403734

x=1.555187E-03 y=1.265900E-03 f(x,y)=3.0000040211075860

x=-8.489601E-04 y=-1.608979E-04 f(x,y)=3.0000007466213736

x=4.906973E-04 y=-8.890937E-04 f(x,y)=3.0000010312714123

x=-4.153806E-04 y=2.868259E-04 f(x,y)=3.0000002548101241

x=1.055830E-03 y=3.983273E-04 f(x,y)=3.0000012734424444

x=-3.727625E-04 y=-2.109164E-05 f(x,y)=3.0000001393967111

x=-1.410394E-03 y=3.151309E-04 f(x,y)=3.0000020885184679

x=1.140897E-04 y=4.173527E-05 f(x,y)=3.0000000147582888

x=1.567078E-04 y=-2.661823E-04 f(x,y)=3.0000000954103454

x=6.435599E-04 y=-2.033554E-04 f(x,y)=3.0000004555228053

x=-1.186819E-04 y=-6.665758E-05 f(x,y)=3.0000000185286173

x=-1.613000E-04 y=2.412600E-04 f(x,y)=3.0000000842240597

x=-8.179803E-05 y=1.143994E-04 f(x,y)=3.0000000197781436

x=7.720585E-05 y=-1.393217E-04 f(x,y)=3.0000000253712864

x=-4.204706E-05 y=5.096913E-05 f(x,y)=3.0000000043658073

x=1.907245E-04 y=1.593620E-04 f(x,y)=3.0000000617720701

x=-4.133027E-05 y=-1.015269E-05 f(x,y)=3.0000000018112689

x=-1.974670E-04 y=-9.188273E-07 f(x,y)=3.0000000389940675

x=3.620051E-05 y=3.107174E-05 f(x,y)=3.0000000022759301

x=3.691729E-05 y=-3.005008E-05 f(x,y)=3.0000000022658937

x=-4.061349E-05 y=-7.127451E-05 f(x,y)=3.0000000067295112

x=1.699701E-05 y=5.485181E-06 f(x,y)=3.0000000003189857

x=-6.125056E-05 y=2.538257E-05 f(x,y)=3.0000000043959054

x=1.237533E-05 y=-1.619192E-05 f(x,y)=3.0000000004153269

x=7.070261E-05 y=-5.540448E-07 f(x,y)=3.0000000049991664

x=-1.332205E-05 y=-7.753028E-06 f(x,y)=3.0000000002375864

x=-8.700374E-06 y=1.392407E-05 f(x,y)=3.0000000002695764

Optimization terminated successfully.
         Current function value: 3.000000
         Iterations: 45
         Function evaluations: 81

</pre></table></code></div></div><p>Resulting in a minimum function value of \(f(x,y) = 3\) where \(x = -8.700374\times 10^{-6}\) and \(y=1.392407 \times 10^{-5}\), which are numerically close to 0 given the convergence tolerance specified.</p><h1 id="conclusion">Conclusion</h1><p>We have minimised equation (1) using a combination of Python and C++. Python controlled the minimisation by piping the parameters, \(x\) and \(y\) to the C++ executable which then returned the function value for Python to decide the values of \(x\) and \(y\) for the next minimisation step. This continued until the convergence tolerance was achieved at which point Python terminated the subprocess and both programs ended.</p><p>It is advised to wrap a C++ program using conventional methods, but sometimes it is far easier to use a subprocess achieving the same results.</p></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/science/" class="post-tag no-text-decoration" >Science</a> <a href="/tags/mathematics/" class="post-tag no-text-decoration" >Mathematics</a> <a href="/tags/programming/" class="post-tag no-text-decoration" >Programming</a> <a href="/tags/subprocess/" class="post-tag no-text-decoration" >subprocess</a> <a href="/tags/minimisation/" class="post-tag no-text-decoration" >minimisation</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=T%3ET:%20Call%20C++%20From%20Python%20Without%20Wrapping%20-%20Dr%20Adam%20Luke%20Baskerville&url=https%3A%2F%2Fadambaskerville.github.io%2Fposts%2FPythonSubprocess%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=T%3ET:%20Call%20C++%20From%20Python%20Without%20Wrapping%20-%20Dr%20Adam%20Luke%20Baskerville&u=https%3A%2F%2Fadambaskerville.github.io%2Fposts%2FPythonSubprocess%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fadambaskerville.github.io%2Fposts%2FPythonSubprocess%2F&text=T%3ET:%20Call%20C++%20From%20Python%20Without%20Wrapping%20-%20Dr%20Adam%20Luke%20Baskerville" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/am1bcc_speedup/">T>T: Turbocharging AM1BCC Charge Calculations</a><li class="text-truncate lh-lg"> <a href="/posts/BuffonNeedle/">T>T: Buffon's Needle: Estimating π using Toothpicks</a><li class="text-truncate lh-lg"> <a href="/posts/HighPrecisionEigenvalues/">T>T: High-Precision Eigenvalue Computations Made Efficient in C++</a><li class="text-truncate lh-lg"> <a href="/posts/DearpyguiCompilation/">T>T: Compiling DearPyGui on Raspberry Pi 32-bit OS</a><li class="text-truncate lh-lg"> <a href="/posts/Introduction-post/">T>T: Introduction</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/mathematics/">mathematics</a> <a class="post-tag btn btn-outline-primary" href="/tags/science/">science</a> <a class="post-tag btn btn-outline-primary" href="/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/tags/mathematics/">Mathematics</a> <a class="post-tag btn btn-outline-primary" href="/tags/programming/">Programming</a> <a class="post-tag btn btn-outline-primary" href="/tags/science/">Science</a> <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a> <a class="post-tag btn btn-outline-primary" href="/tags/chemistry/">chemistry</a> <a class="post-tag btn btn-outline-primary" href="/tags/matplotlib/">matplotlib</a> <a class="post-tag btn btn-outline-primary" href="/tags/length/">length</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/HartreeFockGuide/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1586646000" data-df="ll" > Apr 12, 2020 </time><h4 class="pt-0 my-2">T>T: Hartree Fock Theory in 100 Lines</h4><div class="text-muted"><p>Try the code yourself! Click the following button to launch an ipython notebook on Google Colab which implements the code developed in this post: In a previous post we looked at the hydrogen at...</p></div></div></a></article><article class="col"> <a href="/posts/Variational-Method-Hydrogen/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1579132800" data-df="ll" > Jan 16, 2020 </time><h4 class="pt-0 my-2">T>T: Solving the Hydrogen Atom Variationally</h4><div class="text-muted"><p>Try the code yourself! Click the following button to launch an ipython notebook on Google Colab which implements the code developed in this post: The Problem: We want to solve the Schrödinger ...</p></div></div></a></article><article class="col"> <a href="/posts/LespEigenvalues/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1575244800" data-df="ll" > Dec 2, 2019 </time><h4 class="pt-0 my-2">T>T: When Double Precision is Not Enough</h4><div class="text-muted"><p>Try the code yourself! Click the following button to launch an ipython notebook on Google Colab which implements the code developed in this post: The Problem: We want to solve the following st...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/CumulativeSum/" class="btn btn-outline-primary" aria-label="Older" ><p>T>T: Optimising Cumulative Sums in Python</p></a> <a href="/posts/LespEigenvalues/" class="btn btn-outline-primary" aria-label="Newer" ><p>T>T: When Double Precision is Not Enough</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/SciBaskerville">Adam Baskerville</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.3.0" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/mathematics/">mathematics</a> <a class="post-tag btn btn-outline-primary" href="/tags/science/">science</a> <a class="post-tag btn btn-outline-primary" href="/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/tags/mathematics/">Mathematics</a> <a class="post-tag btn btn-outline-primary" href="/tags/programming/">Programming</a> <a class="post-tag btn btn-outline-primary" href="/tags/science/">Science</a> <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a> <a class="post-tag btn btn-outline-primary" href="/tags/chemistry/">chemistry</a> <a class="post-tag btn btn-outline-primary" href="/tags/matplotlib/">matplotlib</a> <a class="post-tag btn btn-outline-primary" href="/tags/length/">length</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
